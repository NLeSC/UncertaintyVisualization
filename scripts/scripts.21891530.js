!function(){"use strict";angular.module("uncertApp.dc",[]).constant("dc",dc),angular.module("uncertApp.d3",[]).constant("d3",d3),angular.module("uncertApp.D3punchcard",[]).constant("D3punchcard",d3.punchcard),angular.module("uncertApp.crossfilter",[]).constant("crossfilter",crossfilter),angular.module("uncertApp.colorbrewer",[]).constant("colorbrewer",colorbrewer),angular.module("uncertApp",["ngAnimate","ngSanitize","ngTouch","ui.bootstrap","uncertApp.fileLoading","uncertApp.punchcard"]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|blob):/)}]).run(["DataService",function(a){a.load()}]),angular.module("uncertApp.templates",[]),angular.module("uncertApp.utils",["uncertApp.templates"]),angular.module("uncertApp.core",["uncertApp.utils","toastr"]),angular.module("uncertApp.fileLoading",["uncertApp.core","uncertApp.utils"]),angular.module("uncertApp.punchcard",["uncertApp.core","uncertApp.utils","uncertApp.d3","uncertApp.dc","uncertApp.crossfilter","uncertApp.colorbrewer"])}(),function(){"use strict";function a(a){this.publish=function(){return a.$emit.apply(a,arguments)},this.subscribe=function(){return a.$on.apply(a,arguments)}}a.$inject=["$rootScope"],angular.module("uncertApp.utils").service("Messagebus",a)}(),function(){"use strict";angular.module("uncertApp.core").constant("uncertConf",{DATA_JSON_URL:"https://raw.githubusercontent.com/NLeSC/UncertaintyVisualization/gh-pages/data/contextual.timeline24-11-eso.json"})}(),function(){"use strict";function a(a,b,c,d,e,f){var g=this;this.data={};var h=b.defer();this.ready=h.promise,this.load=function(){return a.get(d.DATA_JSON_URL).success(this.onLoad).error(this.onLoadFailure)},this.urlload=function(b){a.get(b.targetScope.fc.query).success(this.onUrlLoad).error(this.onLoadFailure)}.bind(this),this.onUrlLoad=function(a){g.data=a,f.success("New data loaded!"),e.publish("data loaded")},this.onLoad=function(a){g.data=a,h.resolve(a),e.publish("data loaded")},this.onLoadFailure=function(){c.log("Failed to load data!!"),f.error("Failed to load data!!"),h.reject.apply(this,arguments)},this.getData=function(){return this.data},e.subscribe("data request",this.urlload)}a.$inject=["$http","$q","$log","uncertConf","Messagebus","toastr"],angular.module("uncertApp.core").service("DataService",a)}(),dc.baseMixin=function(a){function b(){j&&j.attr("width",a.width()).attr("height",a.height())}function c(){return j=a.root().append("svg"),b(),j}function d(b){if(!a[b]||!a[b]())throw new dc.errors.InvalidStateException("Mandatory attribute chart."+b+" is missing on chart[#"+a.anchorName()+"]")}function e(b){if(a.dimension()&&a.dimension().filter){var c=I(a.dimension(),b);c&&(b=c)}return b}a.__dcFlag__=dc.utils.uniqueId();var f,g,h,i,j,k,l,m,n,o=200,p=function(a){var b=a&&a.getBoundingClientRect&&a.getBoundingClientRect().width;return b&&b>o?b:o},q=p,r=200,s=function(a){var b=a&&a.getBoundingClientRect&&a.getBoundingClientRect().height;return b&&b>r?b:r},t=s,u=dc.pluck("key"),v=dc.pluck("value"),w=dc.pluck("key"),x=dc.pluck("key"),y=!1,z=function(b){return a.keyAccessor()(b)+": "+a.valueAccessor()(b)},A=!0,B=!1,C=750,D=dc.printers.filters,E=["dimension","group"],F=dc.constants.DEFAULT_CHART_GROUP,G=d3.dispatch("preRender","postRender","preRedraw","postRedraw","filtered","zoomed","renderlet","pretransition"),H=[],I=function(a,b){return 0===b.length?a.filter(null):1!==b.length||b[0].isFiltered?1===b.length&&"RangedFilter"===b[0].filterType?a.filterRange(b[0]):a.filterFunction(function(a){for(var c=0;c<b.length;c++){var d=b[c];if(d.isFiltered&&d.isFiltered(a))return!0;if(a>=d&&d>=a)return!0}return!1}):a.filterExact(b[0]),b},J=function(a){return a.all()};a.height=function(b){return arguments.length?(t=d3.functor(b||s),a):t(i.node())},a.width=function(b){return arguments.length?(q=d3.functor(b||p),a):q(i.node())},a.minWidth=function(b){return arguments.length?(o=b,a):o},a.minHeight=function(b){return arguments.length?(r=b,a):r},a.dimension=function(b){return arguments.length?(f=b,a.expireCache(),a):f},a.data=function(b){return arguments.length?(J=d3.functor(b),a.expireCache(),a):J.call(a,g)},a.group=function(b,c){return arguments.length?(g=b,a._groupName=c,a.expireCache(),a):g},a.ordering=function(b){return arguments.length?(x=b,l=crossfilter.quicksort.by(x),a.expireCache(),a):x},a._computeOrderedGroups=function(a){var b=a.slice(0);return b.length<=1?b:(l||(l=crossfilter.quicksort.by(x)),l(b,0,b.length))},a.filterAll=function(){return a.filter(null)},a.select=function(a){return i.select(a)},a.selectAll=function(a){return i?i.selectAll(a):null},a.anchor=function(b,c){if(!arguments.length)return h;if(dc.instanceOfChart(b))h=b.anchor(),i=b.root(),k=!0;else{if(!b)throw new dc.errors.BadArgumentException("parent must be defined");h=b.select&&b.classed?b.node():b,i=d3.select(h),i.classed(dc.constants.CHART_CLASS,!0),dc.registerChart(a,c),k=!1}return F=c,a},a.anchorName=function(){var b=a.anchor();return b&&b.id?b.id:b&&b.replace?b.replace("#",""):"dc-chart"+a.chartID()},a.root=function(b){return arguments.length?(i=b,a):i},a.svg=function(b){return arguments.length?(j=b,a):j},a.resetSvg=function(){return a.select("svg").remove(),c()},a.filterPrinter=function(b){return arguments.length?(D=b,a):D},a.controlsUseVisibility=function(b){return arguments.length?(B=b,a):B},a.turnOnControls=function(){if(i){var b=a.controlsUseVisibility()?"visibility":"display";a.selectAll(".reset").style(b,null),a.selectAll(".filter").text(D(a.filters())).style(b,null)}return a},a.turnOffControls=function(){if(i){var b=a.controlsUseVisibility()?"visibility":"display",c=a.controlsUseVisibility()?"hidden":"none";a.selectAll(".reset").style(b,c),a.selectAll(".filter").style(b,c).text(a.filter())}return a},a.transitionDuration=function(b){return arguments.length?(C=b,a):C},a._mandatoryAttributes=function(b){return arguments.length?(E=b,a):E},a.render=function(){G.preRender(a),E&&E.forEach(d);var b=a._doRender();return m&&m.render(),a._activateRenderlets("postRender"),b},a._activateRenderlets=function(b){G.pretransition(a),a.transitionDuration()>0&&j?j.transition().duration(a.transitionDuration()).each("end",function(){G.renderlet(a),b&&G[b](a)}):(G.renderlet(a),b&&G[b](a))},a.redraw=function(){b(),G.preRedraw(a);var c=a._doRedraw();return m&&m.render(),a._activateRenderlets("postRedraw"),c},a.commitHandler=function(b){return arguments.length?(n=b,a):n},a.redrawGroup=function(){return n?n(!1,function(b,c){b?console.log(b):dc.redrawAll(a.chartGroup())}):dc.redrawAll(a.chartGroup()),a},a.renderGroup=function(){return n?n(!1,function(b,c){b?console.log(b):dc.renderAll(a.chartGroup())}):dc.renderAll(a.chartGroup()),a},a._invokeFilteredListener=function(b){void 0!==b&&G.filtered(a,b)},a._invokeZoomedListener=function(){G.zoomed(a)};var K=function(a,b){return null===b||"undefined"==typeof b?a.length>0:a.some(function(a){return a>=b&&b>=a})};a.hasFilterHandler=function(b){return arguments.length?(K=b,a):K},a.hasFilter=function(a){return K(H,a)};var L=function(a,b){for(var c=0;c<a.length;c++)if(a[c]<=b&&a[c]>=b){a.splice(c,1);break}return a};a.removeFilterHandler=function(b){return arguments.length?(L=b,a):L};var M=function(a,b){return a.push(b),a};a.addFilterHandler=function(b){return arguments.length?(M=b,a):M};var N=function(a){return[]};return a.resetFilterHandler=function(b){return arguments.length?(N=b,a):N},a.replaceFilter=function(b){H=[],a.filter(b)},a.filter=function(b){if(!arguments.length)return H.length>0?H[0]:null;var c=H;return b instanceof Array&&b[0]instanceof Array&&!b.isFiltered?b[0].forEach(function(a){c=K(c,a)?L(c,a):M(c,a)}):c=null===b?N(c):K(c,b)?L(c,b):M(c,b),H=e(c),a._invokeFilteredListener(b),null!==i&&a.hasFilter()?a.turnOnControls():a.turnOffControls(),a},a.reverseFilter=function(b){if(!a.hasFilter()){var c=a.data();c.forEach(function(c){b instanceof Array?b.indexOf(c.key)<0&&a.filter(c.key):b!==c.key&&a.filter(c.key)})}return a},a.filters=function(){return H},a.highlightSelected=function(a){d3.select(a).classed(dc.constants.SELECTED_CLASS,!0),d3.select(a).classed(dc.constants.DESELECTED_CLASS,!1)},a.fadeDeselected=function(a){d3.select(a).classed(dc.constants.SELECTED_CLASS,!1),d3.select(a).classed(dc.constants.DESELECTED_CLASS,!0)},a.resetHighlight=function(a){d3.select(a).classed(dc.constants.SELECTED_CLASS,!1),d3.select(a).classed(dc.constants.DESELECTED_CLASS,!1)},a.onClick=function(b){var c=a.keyAccessor()(b);dc.events.trigger(function(){1!==d3.event.which||d3.event.shiftKey?1===d3.event.which&&a.reverseFilter(c):a.filter(c,1!==d3.event.which),a.redrawGroup()})},a.filterHandler=function(b){return arguments.length?(I=b,a):I},a._doRender=function(){return a},a._doRedraw=function(){return a},a.legendables=function(){return[]},a.legendHighlight=function(){},a.legendReset=function(){},a.legendToggle=function(){},a.isLegendableHidden=function(){return!1},a.keyAccessor=function(b){return arguments.length?(u=b,a):u},a.valueAccessor=function(b){return arguments.length?(v=b,a):v},a.label=function(b,c){return arguments.length?(w=b,(void 0===c||c)&&(y=!0),a):w},a.renderLabel=function(b){return arguments.length?(y=b,a):y},a.title=function(b){return arguments.length?(z=b,a):z},a.renderTitle=function(b){return arguments.length?(A=b,a):A},a.renderlet=dc.logger.deprecate(function(b){return a.on("renderlet."+dc.utils.uniqueId(),b),a},'chart.renderlet has been deprecated.  Please use chart.on("renderlet.<renderletKey>", renderletFunction)'),a.chartGroup=function(b){return arguments.length?(k||dc.deregisterChart(a,F),F=b,k||dc.registerChart(a,F),a):F},a.expireCache=function(){return a},a.legend=function(b){return arguments.length?(m=b,m.parent(a),a):m},a.chartID=function(){return a.__dcFlag__},a.options=function(b){var c=["anchor","group","xAxisLabel","yAxisLabel","stack","title","point","getColor","overlayGeoJson"];for(var d in b)"function"==typeof a[d]?b[d]instanceof Array&&-1!==c.indexOf(d)?a[d].apply(a,b[d]):a[d].call(a,b[d]):dc.logger.debug("Not a valid option setter name: "+d);return a},a.on=function(b,c){return G.on(b,c),a},a},dc.customCompositeChart=function(a,b){function c(){(void 0===s.rightY()||s.elasticY())&&(void 0===s.rightY()&&s.rightY(d3.scale.linear()),s.rightY().domain([j(),m()]).rangeRound([s.yAxisHeight(),0])),s.rightY().range([s.yAxisHeight(),0]),s.rightYAxis(s.rightYAxis().scale(s.rightY())),s.rightYAxis().orient("right")}function d(){(void 0===s.y()||s.elasticY())&&(void 0===s.y()&&s.y(d3.scale.linear()),s.y().domain([i(),l()]).rangeRound([s.yAxisHeight(),0])),s.y().range([s.yAxisHeight(),0]),s.yAxis(s.yAxis().scale(s.y())),s.yAxis().orient("left")}function e(a,b){a._generateG(s.g()),a.g().attr("class",q+" _"+b)}function f(){return t.filter(function(a){return!a.useRightYAxis()})}function g(){return t.filter(function(a){return a.useRightYAxis()})}function h(a){return a.map(function(a){return a.yAxisMin()})}function i(){return d3.min(h(f()))}function j(){return d3.min(h(g()))}function k(a){return a.map(function(a){return a.yAxisMax()})}function l(){return dc.utils.add(d3.max(k(f())),s.yAxisPadding())}function m(){return dc.utils.add(d3.max(k(g())),s.yAxisPadding())}function n(){return t.map(function(a){return a.xAxisMin()})}function o(){return t.map(function(a){return a.xAxisMax()})}var p,q="sub",r=12,s=dc.coordinateGridMixin({}),t=[],u={},v=!1,w=!0,x=d3.svg.axis(),y=0,z=r,A=!1;return s._mandatoryAttributes([]),s.transitionDuration(500),dc.override(s,"_generateG",function(){for(var a=this.__generateG(),b=0;b<t.length;++b){var c=t[b];e(c,b),c.dimension()||c.dimension(s.dimension()),c.group()||c.group(s.group()),c.chartGroup(s.chartGroup()),c.svg(s.svg()),c.xUnits(s.xUnits()),c.transitionDuration(s.transitionDuration()),c.brushOn(s.brushOn()),c.renderTitle(s.renderTitle()),c.elasticX(s.elasticX())}return a}),s.setHandlePaths=function(){},dc.override(s,"_filter",function(a){return arguments.length?s.__filter(dc.filters.RangedTwoDimensionalFilter(a)):s.__filter()}),s.extendBrush=function(){var a=s.brush().extent();return s.round()&&(a[0]=a[0].map(s.round()),a[1]=a[1].map(s.round()),s.g().select(".brush").call(s.brush().extent(a))),a},s.brushIsEmpty=function(a){return s.brush().empty()||!a||a[0][0]>=a[1][0]||a[0][1]>=a[1][1]},s._brushing=function(){var a=s.extendBrush();if(s.redrawBrush(s.g()),s.brushIsEmpty(a))dc.events.trigger(function(){s.replaceFilter(null),s.redrawGroup()});else{var b=dc.filters.RangedTwoDimensionalFilter(a);dc.events.trigger(function(){s.replaceFilter(b),s.redrawGroup()},dc.constants.EVENT_DELAY)}},s.setBrushY=function(a){a.call(s.brush().y(s.y()))},s._prepareYAxis=function(){0!==f().length&&d(),0!==g().length&&c(),f().length>0&&!A?s._renderHorizontalGridLinesForAxis(s.g(),s.y(),s.yAxis()):g().length>0&&s._renderHorizontalGridLinesForAxis(s.g(),p,x)},s.renderYAxis=function(){0!==f().length&&(s.renderYAxisAt("y",s.yAxis(),s.margins().left),s.renderYAxisLabel("y",s.yAxisLabel(),-90)),0!==g().length&&(s.renderYAxisAt("yr",s.rightYAxis(),s.width()-s.margins().right),s.renderYAxisLabel("yr",s.rightYAxisLabel(),90,s.width()-z))},s.plotData=function(){for(var a=0;a<t.length;++a){var b=t[a];b.g()||e(b,a),v&&b.colors(s.colors()),b.x(s.x()),b.xAxis(s.xAxis()),b.useRightYAxis()?(b.y(s.rightY()),b.yAxis(s.rightYAxis())):(b.y(s.y()),b.yAxis(s.yAxis())),b.plotData(),b._activateRenderlets()}},s.useRightAxisGridLines=function(a){return arguments?(A=a,s):A},s.childOptions=function(a){return arguments.length?(u=a,t.forEach(function(a){a.options(u)}),s):u},s.fadeDeselectedArea=function(){for(var a=0;a<t.length;++a){var b=t[a];b.brush(s.brush()),b.fadeDeselectedArea()}},s.rightYAxisLabel=function(a,b){return arguments.length?(y=a,s.margins().right-=z,z=void 0===b?r:b,s.margins().right+=z,s):y},s.compose=function(a){return t=a,t.forEach(function(a){a.height(s.height()),a.width(s.width()),a.margins(s.margins()),w&&a.title(s.title()),a.options(u)}),s},s.children=function(){return t},s.shareColors=function(a){return arguments.length?(v=a,s):v},s.shareTitle=function(a){return arguments.length?(w=a,s):w},s.rightY=function(a){return arguments.length?(p=a,s.rescale(),s):p},delete s.yAxisMin,delete s.yAxisMax,dc.override(s,"xAxisMin",function(){return dc.utils.subtract(d3.min(n()),s.xAxisPadding())}),dc.override(s,"xAxisMax",function(){return dc.utils.add(d3.max(o()),s.xAxisPadding())}),s.legendables=function(){return t.reduce(function(a,b){return v&&b.colors(s.colors()),a.push.apply(a,b.legendables()),a},[])},s.legendHighlight=function(a){for(var b=0;b<t.length;++b){var c=t[b];c.legendHighlight(a)}},s.legendReset=function(a){for(var b=0;b<t.length;++b){var c=t[b];c.legendReset(a)}},s.legendToggle=function(){console.log("composite should not be getting legendToggle itself")},s.rightYAxis=function(a){return arguments.length?(x=a,s):x},s.anchor(a,b)},dc.customSeriesChart=function(a,b){function c(a,b){return d3.ascending(g.keyAccessor()(a),g.keyAccessor()(b))}function d(a){h[a].g()&&h[a].g().remove(),delete h[a]}function e(){Object.keys(h).map(d),h={}}var f,g=dc.compositeChart(a,b),h={},i=dc.lineChart,j=d3.ascending,k=c;return g._mandatoryAttributes().push("seriesAccessor","chart"),g.shareColors(!0),g._preprocessData=function(){var a,c=[],e=d3.nest().key(f);j&&e.sortKeys(j),k&&e.sortValues(k);var l=e.entries(g.data()),m=l.map(function(d,e){var f=h[d.key]||i.call(g,g,b,d.key,e);return h[d.key]||(a=!0),h[d.key]=f,c.push(d.key),f.dimension(g.dimension()).group({all:d3.functor(d.values)},d.key).keyAccessor(g.keyAccessor()).valueAccessor(g.valueAccessor())});Object.keys(h).filter(function(a){return-1===c.indexOf(a)}).forEach(function(b){d(b),a=!0}),g._compose(m),a&&g.legend()&&g.legend().render()},dc.override(g,"_filter",function(a){return arguments.length?g.__filter(dc.filters.RangedTwoDimensionalFilter(a)):g.__filter()}),g.setHandlePaths=function(){},g.extendBrush=function(){var a=g.brush().extent();return g.round()&&(a[0]=a[0].map(g.round()),a[1]=a[1].map(g.round()),g.g().select(".brush").call(g.brush().extent(a))),a},g.brushIsEmpty=function(a){return g.brush().empty()||!a||a[0][0]>=a[1][0]||a[0][1]>=a[1][1]},g._brushing=function(){var a=g.extendBrush();if(g.redrawBrush(g.g()),g.brushIsEmpty(a))dc.events.trigger(function(){g.replaceFilter(null),g.redrawGroup()});else{var b=dc.filters.RangedTwoDimensionalFilter(a);dc.events.trigger(function(){g.replaceFilter(b),g.redrawGroup()},dc.constants.EVENT_DELAY)}},g.setBrushY=function(a){a.call(g.brush().y(g.y()))},g.chart=function(a){return arguments.length?(i=a,e(),g):i},g.seriesAccessor=function(a){return arguments.length?(f=a,e(),g):f},g.seriesSort=function(a){return arguments.length?(j=a,e(),g):j},g.valueSort=function(a){return arguments.length?(k=a,e(),g):k},g._compose=g.compose,delete g.compose,g},dc.customScatterPlot=function(a,b){function c(a,b){var c=e.selectAll(".chart-body path.symbol").filter(function(){return a(d3.select(this))}),d=f.size();f.size(Math.pow(b,2)),dc.transition(c,e.transitionDuration()).attr("d",f),f.size(d)}function d(a){var b=e.selectAll(".chart-body path.symbol").each(function(b){this.filtered=a&&a.isFiltered(b.key)});dc.transition(b,e.transitionDuration()).attr("d",f)}var e=dc.coordinateGridMixin({}),f=d3.svg.symbol(),g=function(a){return a.value},h=e.keyAccessor();e.keyAccessor(function(a){return h(a)[0]}),e.valueAccessor(function(a){return h(a)[1]}),e.colorAccessor(function(){return e._groupName});var i=function(a){return"translate("+e.x()(e.keyAccessor()(a))+","+e.y()(e.valueAccessor()(a))+")"},j=3,k=5,l=0;return f.size(function(a){return g(a)?this.filtered?Math.pow(k,2):Math.pow(j,2):l}),dc.override(e,"_filter",function(a){return arguments.length?e.__filter(dc.filters.RangedTwoDimensionalFilter(a)):e.__filter()}),e.plotData=function(){var a=e.chartBodyG().selectAll("path.symbol").data(e.data());a.enter().append("path").attr("class","symbol").attr("opacity",0).attr("fill",e.getColor).attr("transform",i),dc.transition(a,e.transitionDuration()).attr("opacity",function(a){return g(a)?1:0}).attr("fill",e.getColor).attr("transform",i).attr("d",f),dc.transition(a.exit(),e.transitionDuration()).attr("opacity",0).remove()},e.existenceAccessor=function(a){return arguments.length?(g=a,this):g},e.symbol=function(a){return arguments.length?(f.type(a),e):f.type()},e.symbolSize=function(a){return arguments.length?(j=a,e):j},e.highlightedSize=function(a){return arguments.length?(k=a,e):k},e.hiddenSize=function(a){return arguments.length?(l=a,e):l},e.legendables=function(){return[{chart:e,name:e._groupName,color:e.getColor()}]},e.legendHighlight=function(a){c(function(b){return b.attr("fill")===a.color},k),e.selectAll(".chart-body path.symbol").filter(function(){return d3.select(this).attr("fill")!==a.color}).classed("fadeout",!0)},e.legendReset=function(a){c(function(b){return b.attr("fill")===a.color},j),e.selectAll(".chart-body path.symbol").filter(function(){return d3.select(this).attr("fill")!==a.color}).classed("fadeout",!1)},e.setHandlePaths=function(){},e.extendBrush=function(){var a=e.brush().extent();return e.round()&&(a[0]=a[0].map(e.round()),a[1]=a[1].map(e.round()),e.g().select(".brush").call(e.brush().extent(a))),a},e.brushIsEmpty=function(a){return e.brush().empty()||!a||a[0][0]>=a[1][0]||a[0][1]>=a[1][1]},e._brushing=function(){var a=e.extendBrush();if(e.redrawBrush(e.g()),e.brushIsEmpty(a))dc.events.trigger(function(){e.filter(null),e.redrawGroup()}),d(!1);else{var b=dc.filters.RangedTwoDimensionalFilter(a);dc.events.trigger(function(){e.filter(null),e.filter(b),e.redrawGroup()},dc.constants.EVENT_DELAY),d(b)}},e.setBrushY=function(a){a.call(e.brush().y(e.y()))},e.anchor(a,b)},dc.customBubbleMixin=function(a){var b=.3,c=10;a.BUBBLE_NODE_CLASS="node",a.BUBBLE_CLASS="bubble",a.MIN_RADIUS=10,a=dc.colorMixin(a),a.renderLabel(!0),a.data(function(a){return a.top(1/0)});var d=d3.scale.linear().domain([0,100]),e=function(a){return a.r};a.r=function(b){return arguments.length?(d=b,a):d},a.radiusValueAccessor=function(b){return arguments.length?(e=b,a):e},a.rMin=function(){var b=d3.min(a.data(),function(b){return a.radiusValueAccessor()(b)});return b},a.rMax=function(){var b=d3.max(a.data(),function(b){return a.radiusValueAccessor()(b)});return b},a.bubbleR=function(b){var c=a.radiusValueAccessor()(b),d=a.r()(c);return(isNaN(d)||0>=c)&&(d=0),d};var f=function(b){return a.label()(b)},g=function(b){return a.bubbleR(b)>c?1:0};a._doRenderLabel=function(b){a.y().range().length,a.effectiveHeight();if(a.renderLabel()){var c=b.select("text");c.empty()&&(c=b.append("text").attr("class","bubble-text").attr("dx",".3em").attr("transform","rotate(-45) translate(5,0) ").attr("text-anchor","left").attr("dy",".3em").on("click",a.onClick)),c.attr("opacity",0).text(f),dc.transition(c,a.transitionDuration()).attr("opacity",g)}},a.doUpdateLabels=function(b){if(a.renderLabel()){var c=b.selectAll("text").text(f);dc.transition(c,a.transitionDuration()).attr("opacity",g)}};var h=function(b){return a.title()(b)};return a._doRenderTitles=function(b){if(a.renderTitle()){var c=b.select("title");c.empty()&&b.append("title").text(h)}},a.doUpdateTitles=function(b){a.renderTitle()&&b.selectAll("title").text(h)},a.minRadius=function(b){return arguments.length?(a.MIN_RADIUS=b,a):a.MIN_RADIUS},a.minRadiusWithLabel=function(b){return arguments.length?(c=b,a):c},a.maxBubbleRelativeSize=function(c){return arguments.length?(b=c,a):b},a.fadeDeselectedArea=function(){a.hasFilter()?a.selectAll("g."+a.BUBBLE_NODE_CLASS).each(function(b){a.isSelectedNode(b)?a.highlightSelected(this):a.fadeDeselected(this)}):a.selectAll("g."+a.BUBBLE_NODE_CLASS).each(function(){a.resetHighlight(this)})},a.isSelectedNode=function(b){return a.hasFilter(b.key)},a.onClick=function(b){var c=b.key;dc.events.trigger(function(){a.filter(c),a.redrawGroup()})},a},dc.customBubbleChart=function(a,b){function c(a){var b=i.y().range();a.empty()&&(a=i.chartBodyG().insert("g",":first-child").attr("class","grid-line horizontal").attr("transform","translate("+i.margins().left+","+i.margins().top+")"));var c=a.selectAll("line").data(b),d=c.enter().append("line").attr("x1",-i.margins().left).attr("y1",function(a){return a}).attr("x2",i.xAxisLength()).attr("y2",function(a){return a}).attr("opacity",1);dc.transition(d,i.transitionDuration()).attr("opacity",1),dc.transition(c,i.transitionDuration()).attr("x1",-i.margins().left).attr("y1",function(a){return a}).attr("x2",i.xAxisLength()).attr("y2",function(a){return a}),c.exit().remove()}function d(a){var b=a.enter().append("g");b.attr("class",i.BUBBLE_NODE_CLASS).attr("transform",k).append("circle").attr("class",function(a,b){return i.BUBBLE_CLASS+" _"+b}).on("click",i.onClick).attr("fill",i.getColor).attr("r",0),dc.transition(a,i.transitionDuration()).selectAll("circle."+i.BUBBLE_CLASS).attr("r",function(a){return i.bubbleR(a)}).attr("opacity",function(a){return i.bubbleR(a)>0?1:0}),i._doRenderLabel(b),i._doRenderTitles(b)}function e(a){dc.transition(a,i.transitionDuration()).attr("transform",k).selectAll("circle."+i.BUBBLE_CLASS).attr("fill",i.getColor).attr("r",function(a){return i.bubbleR(a)}).attr("opacity",function(a){return i.bubbleR(a)>0?1:0}),i.doUpdateLabels(a),i.doUpdateTitles(a)}function f(a){a.exit().remove()}function g(a){var b=i.x()(i.keyAccessor()(a));return isNaN(b)&&(b=0),b}function h(a){var b=i.y().range().length,c=i.effectiveHeight(),d=c/b,e=i.y()(i.valueAccessor()(a));return isNaN(e)&&(e=0),dc.utils.safeNumber(e+.5*d)}var i=dc.customBubbleMixin(dc.coordinateGridMixin({})),j=!1;i.transitionDuration(750);var k=function(a){return"translate("+g(a)+","+h(a)+")"};return i.elasticRadius=function(a){return arguments.length?(j=a,i):j},i.plotData=function(){j&&i.r().domain([i.rMin(),i.rMax()]),i.r().range([i.MIN_RADIUS,i.xAxisLength()*i.maxBubbleRelativeSize()]);var a=i.chartBodyG().selectAll("g.horizontal");c(a);var b=i.chartBodyG().selectAll("g."+i.BUBBLE_NODE_CLASS).data(i.data(),function(a){return a.key});d(b),e(b),f(b),i.fadeDeselectedArea()},i.renderBrush=function(){},i.redrawBrush=function(){},i.anchor(a,b)},dc.subwayChart=function(a,b){function c(a,b){this.x=a,this.yRaw=b}function d(a,b){this.lineID=a,this.stations=b,this.segments=[]}function e(a,b){return void 0===b[a.x]?b[a.x]=[a]:b[a.x].push(a),b}function f(a,b){var c=6,d=Object.keys(a);return d.forEach(function(d){var e=a[d],f=Object.keys(e.stations);f.sort(function(a,b){return Number.isNaN(parseInt(a))&&Number.isNaN(parseInt(b))?new Date(a)-new Date(b):!Number.isNaN(parseInt(a))&&0===parseInt(a)||!Number.isNaN(parseInt(b))&&0!==parseInt(b)?-1:(!Number.isNaN(parseInt(a))&&0!==parseInt(a)||!Number.isNaN(parseInt(b))&&0===parseInt(b),1)});for(var g=f.length,h=0;g-1>h;h++){var i=f[h],j=f[h+1],k=e.stations[i],l=e.stations[j];k.sort(function(a,c){return b.indexOf(a)-b.indexOf(c)}),l.sort(function(a,c){return b.indexOf(a)-b.indexOf(c)});var m=0,n=0;.5*-k.length*c,.5*-l.length*c;k.forEach(function(a){l.forEach(function(b){e.segments.push({source:a,target:b,visible:!0}),n++}),m++})}}),a}function g(a){var b=(r.y().domain(),Object.keys(a));b.sort(function(a,b){return new Date(a)-new Date(b)});var c=[];return b.forEach(function(b){a[b].forEach(function(a){a.yRaw.forEach(function(a){c.indexOf(a)<0&&c.push(a)})})}),r.y().domain(c),c}function h(a,b){a.enter().insert("g",":first-child").attr("stroke",function(a){return v(a.lineID)}).attr("class",function(a,b){return"subway-line _"+b});var c=a.selectAll("path.diagonal").data(function(a){return a.segments});c.enter().insert("path","g").attr("class","diagonal").attr("d",function(a){var b={x:a.source.x0||0,y:a.source.y0||0},c={x:a.target.x0||0,y:a.target.y0||0};return j(B({source:b,target:c}))}).attr("opacity",function(a){return a.visible?1:0})}function i(a,b){var c=a.selectAll("path.diagonal").data(function(a){return a.segments});dc.transition(c,r.transitionDuration()).attr("d",B).attr("opacity",function(a){return a.visible?1:0}),c.exit().remove()}function j(a){return!a||a.indexOf("NaN")>=0||a.indexOf("Infinity")>=0?"M0,0":a}function k(a){var b=a.enter().append("g");b.attr("class",r.BUBBLE_NODE_CLASS).attr("transform",w).append("ellipse").attr("class",function(a,b){return r.BUBBLE_CLASS+" _"+b}).on("click",r.onClick).attr("fill",r.getColor).attr("width",0).attr("height",0),dc.transition(a,r.transitionDuration()).selectAll("ellipse."+r.BUBBLE_CLASS).attr("ry",function(a){return r.bubbleR(a)}).attr("rx",function(a){return r.minRadius()}).attr("opacity",function(a){return r.bubbleR(a)>0?1:0}),r._doRenderLabel(b),r._doRenderTitles(b)}function l(a){dc.transition(a,r.transitionDuration()).attr("transform",w).selectAll("ellipse."+r.BUBBLE_CLASS).attr("fill",r.getColor).attr("ry",function(a){return r.bubbleR(a)}).attr("rx",function(a){return r.minRadius()}).attr("opacity",function(a){return r.bubbleR(a)>0?1:0}),r.doUpdateLabels(a),r.doUpdateTitles(a)}function m(a){a.exit().remove()}function n(a){var b=r.x()(r.keyAccessor()(a));return isNaN(b)&&(b=0),b}function o(a){var b=A(r.keyAccessor()(a),{yRaw:r.valueAccessor()(a)});return b}var p,q,r=dc.customBubbleMixin(dc.stackMixin(dc.coordinateGridMixin({}))),s=!1,t="monotone",u=.1;r.BUBBLE_CLASS="subwayBubble";var v;r.transitionDuration(750);var w=function(a){return"translate("+n(a)+","+o(a)+")"};r.elasticRadius=function(a){return arguments.length?(s=a,r):s},Object.prototype.renameProperty=function(a,b){return a===b?this:(this.hasOwnProperty(a)&&(this[b]=this[a],delete this[a]),this)};var x,y=function(a){var b={},h={};a.forEach(function(a){if(a.value.count>0){var f=Object.keys(a.key[1]);f.forEach(function(f){var g=a.key[1][f],i=r.valueAccessor()(a);void 0===b[g]&&(b[g]=new d(g,{})),e(new c(a.key[0],i),b[g].stations),e(new c(a.key[0],i),h)})}});var i=g(h),j=Object.keys(b);j.forEach(function(a){var c=Object.keys(b[a].stations);c.forEach(function(c){for(var d=r.x()(new Date(c)),e=0;e<b[a].stations[c].length;e++)b[a].stations[c][e].x=d,b[a].stations[c][e].y=A(c,b[a].stations[c][e])}),e({x:r.x().range()[0],y:A(0,{x:0,yRaw:[a]})},b[a].stations),e({x:r.x().range()[1],y:A(0,{x:0,yRaw:[a]})},b[a].stations)}),f(b,i);var k=[],l=Object.keys(b);return l.forEach(function(a){k.push(b[a])}),v=d3.scale.category20b().domain(l),k},z=function(a){var b={};a.forEach(function(a){if(a.value.count>0){var d=Object.keys(a.key[1]);d.forEach(function(d){var f=r.valueAccessor()(a);e(new c(a.key[0],f),b)})}});var d=g(b);return x.forEach(function(a){for(var b=Object.keys(a.stations),c=0;c<b.length;c++){var e=b[c];if(Number.isNaN(parseInt(e)))for(var f=0;f<a.stations[e].length;f++)a.stations[e][f].x0=a.stations[e][f].x,a.stations[e][f].y0=a.stations[e][f].y,a.stations[e][f].x=r.x()(new Date(e)),a.stations[e][f].y=A(e,a.stations[e][f]);else a.stations[e][0].x0=a.stations[e][0].x,a.stations[e][0].y0=a.stations[e][0].y,0===parseInt(e)?(a.stations[e][0].x=r.x().range()[0],a.stations[e][0].y=A(0,{x:0,yRaw:[a.lineID]})):(a.stations[e][0].x=r.x().range()[1],a.stations[e][0].y=A(0,{x:0,yRaw:[a.lineID]}))}d.indexOf(a.lineID)>=0?a.segments.forEach(function(a){a.visible=!0}):a.segments.forEach(function(a){a.visible=!1})}),x},A=function(a,b){for(var c=r.y().range().length,d=r.effectiveHeight(),e=d/c,f=0,g=r.y().domain(),h=0;h<g.length;h++)b.yRaw.indexOf(g[h])>=0&&(f=r.y()(g[h]));var i=f;isNaN(i)&&(i=0);var j=dc.utils.safeNumber(i+.5*e);return j};r.plotData=function(){s&&r.r().domain([r.rMin(),r.rMax()]),r.r().range([r.MIN_RADIUS,r.xAxisLength()*r.maxBubbleRelativeSize()]),x=void 0===x?y(r.data()):z(r.data());var a=r.chartBodyG().selectAll("g.subway-line").data(x);h(a,x),i(a,x),a.exit().remove();var b=r.chartBodyG().selectAll("g."+r.BUBBLE_NODE_CLASS).data(r.data(),function(a){return a.key});k(b),l(b),m(b),r.fadeDeselectedArea()},r.interpolate=function(a){return arguments.length?(t=a,r):t},r.tension=function(a){return arguments.length?(u=a,r):u},r.defined=function(a){return arguments.length?(p=a,r):p},r.dashStyle=function(a){return arguments.length?(q=a,r):q};var B=d3.svg.diagonal().source(function(a){return{x:a.source.y,y:a.source.x}}).target(function(a){return{x:a.target.y,y:a.target.x}}).projection(function(a){return[a.y,a.x]});return r.renderBrush=function(){},r.redrawBrush=function(){},r.anchor(a,b)},dc.laneChart=function(a,b){function c(){if(!t||u){var a=d3.extent(v,G.cappedValueAccessor);a[0]>0&&(a[0]=0),t=d3.scale.linear().domain(a).range([0,G.effectiveWidth()])}H.scale(t)}function d(){var a=s.select("g.axis");c(),a.empty()&&(a=s.append("g").attr("class","axis")),a.attr("transform","translate(0, "+G.effectiveHeight()+")"),dc.transition(a,G.transitionDuration()).call(H)}function e(){s.selectAll("g.tick").select("line.grid-line").remove(),s.selectAll("g.tick").append("line").attr("class","grid-line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",function(){return-G.effectiveHeight()})}function f(){v=G.data(),d(),e();var a=s.selectAll("g."+D).data(v);g(a),h(a),j(a)}function g(a){var b=a.enter().append("g").attr("class",function(a,b){return D+" _"+b});b.append("rect").attr("width",0),l(b),m(a)}function h(a){a.exit().remove()}function i(){var a=t(0);return a===-(1/0)||a!==a?t(1):a}function j(a){var b,c=v.length;b=C?C:(G.effectiveHeight()-(c+1)*B)/c,y||(x=b/2);var d=a.attr("transform",function(a,c){return"translate(0,"+((c+1)*B+c*b)+")"}).select("rect").attr("height",b).attr("fill",G.getColor).on("click",n).classed("deselected",function(a){return G.hasFilter()?!p(a):!1}).classed("selected",function(a){return G.hasFilter()?p(a):!1});dc.transition(d,G.transitionDuration()).attr("width",function(a){return Math.abs(i()-t(G.valueAccessor()(a)))}).attr("transform",o),k(a),m(a)}function k(a){G.renderTitle()&&(a.selectAll("title").remove(),a.append("title").text(G.title()))}function l(a){G.renderLabel()&&a.append("text").on("click",n),G.renderTitleLabel()&&a.append("text").attr("class",E).on("click",n)}function m(a){if(G.renderLabel()){var b=a.select("text").attr("x",w).attr("y",x).attr("dy",z).on("click",n).attr("class",function(a,b){return D+" _"+b}).text(function(a){return G.label()(a)});dc.transition(b,G.transitionDuration()).attr("transform",o)}if(G.renderTitleLabel()){var c=a.select("."+E).attr("x",G.effectiveWidth()-A).attr("y",x).attr("text-anchor","end").on("click",n).attr("class",function(a,b){
return E+" _"+b}).text(function(a){return G.title()(a)});dc.transition(c,G.transitionDuration()).attr("transform",o)}}function n(a){G.onClick(a)}function o(a){var b=t(G.cappedValueAccessor(a)),c=i(),d=b>c?c:b;return"translate("+d+",0)"}function p(a){return G.hasFilter(G.cappedKeyAccessor(a))}function q(a){J[a].g()&&J[a].g().remove(),delete J[a]}function r(){Object.keys(J).map(q),J={}}var s,t,u,v,w=10,x=15,y=!1,z="0.35em",A=2,B=5,C=!1,D="row",E="titlerow",F=!1,G=dc.capMixin(dc.marginMixin(dc.colorMixin(dc.baseMixin({})))),H=d3.svg.axis().orient("bottom");G.rowsCap=G.cap,G._doRender=function(){return G.resetSvg(),s=G.svg().append("g").attr("transform","translate("+G.margins().left+","+G.margins().top+")"),f(),G},G.title(function(a){return G.cappedKeyAccessor(a)+": "+G.cappedValueAccessor(a)}),G.label(G.cappedKeyAccessor),G.x=function(a){return arguments.length?(t=a,G):t},G.renderTitleLabel=function(a){return arguments.length?(F=a,G):F},G._doRedraw=function(){return f(),G},G.xAxis=function(){return H},G.fixedBarHeight=function(a){return arguments.length?(C=a,G):C},G.gap=function(a){return arguments.length?(B=a,G):B},G.elasticX=function(a){return arguments.length?(u=a,G):u},G.labelOffsetX=function(a){return arguments.length?(w=a,G):w},G.labelOffsetY=function(a){return arguments.length?(x=a,y=!0,G):x},G.titleLabelOffsetX=function(a){return arguments.length?(A=a,G):A};var I,J={};dc.lineChart,d3.ascending;return G.seriesAccessor=function(a){return arguments.length?(I=a,r(),G):I},G.anchor(a,b)},function(){"use strict";function a(a,b,c,d,e,f){var g=function(a){return a.reduce(function(a,b){return a.indexOf(b)<0&&a.push(b),a},[])},h=function(a,b){var c;return a.forEach(function(a){0===a.uri.localeCompare(b)&&(c=a)}),c},i=function(a,b){var c=[],d=a.mentions;d.forEach(function(a){var d=a.uri[0];void 0!==a.uri[1]&&console.log("unparsed mention here");var e=parseInt(a["char"][0]),f=parseInt(a["char"][1]),g=h(b,d);c.push({charStart:e,charEnd:f,text:g.text})});var e="";return c.forEach(function(a){var b=a.text.substring(a.charStart-30,a.charStart),c=a.text.substring(a.charStart,a.charEnd),d=a.text.substring(a.charEnd,a.charEnd+30);e+=b+"<span class='highlighted-mention'>"+c+"</span>"+d+"</BR>\n"}),e},j=function(a,b){var c=[],d=a.mentions;d.forEach(function(a){var d=a.uri[0];void 0!==a.uri[1]&&console.log("unparsed mention here");var e=parseInt(a["char"][0]),f=parseInt(a["char"][1]),g=h(b,d);c.push({charStart:e,charEnd:f,text:g.text})});var e="";return c.forEach(function(a){var b=a.text.substring(a.charStart-30,a.charStart),c=a.text.substring(a.charStart,a.charEnd),d=a.text.substring(a.charEnd,a.charEnd+30);e+=b+c+d+"\n"}),e},k=b.scale.ordinal().range(b.svg.symbolTypes),l=function(a){a.selectAll("g.row").each(function(){b.select(this).append("path").data(b.select(this).data()).attr("class","symbol").attr("opacity","1").attr("fill",a.getColor).attr("transform",function(){return"translate("+b.select(this.parentNode).select("rect")[0][0].getAttribute("height")/4+","+b.select(this.parentNode).select("rect")[0][0].getAttribute("height")/4+")"}).attr("d",function(a){var c=b.svg.symbol();return c.size(b.select(this.parentNode).select("rect")[0][0].getAttribute("height")),c.type(k(a.key)),c()}),b.select(this).select("rect").attr("transform",function(){return"translate("+b.select(this.parentNode).select("rect")[0][0].getAttribute("height")/2+",0)"})})};this.readData=function(){function f(a,b){var c=Object.keys(b.actors);return c.forEach(function(c){var d=b.actors[c];d.forEach(function(b){var c=b.split(":"),d=c[0];"nwr-non-entities"===d||"ne"===d||(a[b]=(a[b]||0)+1)})}),a}function h(a,b){var c=Object.keys(b.actors);return c.forEach(function(c){var d=b.actors[c];d.forEach(function(b){var c=b.split(":"),d=c[0];"nwr-non-entities"===d||"ne"===d||(a[b]=(a[b]||0)-1)})}),a}function m(){return{}}function n(a){return{all:function(){return a.all().filter(function(a){var b=parseInt(a.key.split(":")[0]);return b>1})},top:function(b){return a.top(1/0).filter(function(a){var b=parseInt(a.key.split(":")[0]);return b>1}).slice(0,b)}}}function o(a){return{all:function(){return a.all().filter(function(a){var b=parseInt(a.key[0].split(":")[0]);return b>1})},top:function(b){return a.top(1/0).filter(function(a){var b=parseInt(a.key[0].split(":")[0]);return b>1}).slice(0,b)}}}var p=a.getData(),q=p.timeline.events,r=p.timeline.sources,s=d(q),t=c.rowChart("#rowchart_allActors"),u=s.dimension(function(a){var b=[],c=Object.keys(a.actors);c.forEach(function(c){var d=a.actors[c];d.forEach(function(a){var c=a.split(":"),d=c[0],e=c[1];"nwr-non-entities"===d||"ne"===d||b.push(d+":"+e)})});var d=g(b);return d}),v=u.groupAll().reduce(f,h,m).value();v.all=function(){var a=[];for(var b in this)this.hasOwnProperty(b)&&"all"!==b&&"top"!==b&&"order"!==b&&a.push({key:b,value:this[b]});return a},v.top=function(a){var b=this.all().sort(function(a,b){return b.value-a.value}).slice(0,a);return b},t.width(parseInt(b.select("#rowchart_allActors").style("width"),10)).height(400).margins({top:10,right:0,bottom:20,left:0}).dimension(u).keyAccessor(function(a){return a.key}).group(v).valueAccessor(function(a){return a.value}).x(b.scale.linear()).elasticX(!0).filterHandler(function(a,b){return a.filter(null),0===b.length?a.filter(null):a.filter(function(a){var b=!0;if(null!==t.filters()){var c=t.filters();c.forEach(function(c){a.indexOf(c)<0&&(b=!1)})}return b}),b}).xAxis().tickValues([]),t.render();var w=c.subwayChart("#subwayChart"),x=s.dimension(function(a){var c=b.time.format("%Y%m%d").parse(a.time),d=[],e=Object.keys(a.actors);e.forEach(function(b){var c=a.actors[b];c.forEach(function(a){var b=a.split(":"),c=b[0],e=b[1];"nwr-non-entities"===c||"ne"===c||d.push(c+":"+e)})});var f=g(d);return[c,f]}),y=x.group().reduce(function(a,b){return a.count=a.count+1,b.labels.forEach(function(b){a.labels[b]=(a.labels[b]||0)+a.count}),b.mentions.forEach(function(b){a.mentions.push(b)}),a},function(a,b){return a.count=a.count-1,b.labels.forEach(function(b){a.labels[b]=(a.labels[b]||0)-a.count}),b.mentions.forEach(function(b){a.mentions.pop(b)}),a},function(){return{count:0,labels:{},mentions:[]}}),z=[];y.all().map(function(a){a.key[1].forEach(function(a){z.indexOf(a)<0&&z.push(a)})}),w.width(parseInt(b.select("#subwayChart").style("width"),10)).height(400).margins({top:10,right:0,bottom:20,left:150}).dimension(x).group(y).transitionDuration(1500).x(b.time.scale()).elasticX(!0).xAxisPadding(100).keyAccessor(function(a){return a.key[0]}).y(b.scale.ordinal().domain(function(){return z}())).valueAccessor(function(a){return a.key[1]}).r(b.scale.linear()).elasticRadius(!0).radiusValueAccessor(function(a){return a.value.count>0?a.key[1].length:0}).minRadius(5).maxBubbleRelativeSize(.015).renderLabel(!0).minRadiusWithLabel(0).label(function(a){var b,c=-1,d=Object.keys(a.value.labels);return d.forEach(function(d){a.value.labels[d]>c&&(b=d,c=a.value.labels[d])}),b.toString()}).renderTitle(!0).title(function(a){var b=(a.key[0].getDay()+"/"+a.key[0].getMonth()+"/"+a.key[0].getFullYear(),a.key[1]),c="";b.forEach(function(a){c+=a+"\n"});var d="",e=Object.keys(a.value.labels);e.forEach(function(a){d+=a+"\n"});var f="\n---Actors-------\n"+c+"\n---Labels-------\n"+d+"\n---Mentions-----\n"+j(a.value,r);return f}),c.override(w,"xAxisMin",function(){var a=b.min(w.data(),function(a){return w.radiusValueAccessor()(a)>0?w.keyAccessor()(a):void 0});return c.utils.subtract(a,w.xAxisPadding())}),c.override(w,"xAxisMax",function(){var a=b.max(w.data(),function(a){return w.radiusValueAccessor()(a)>0?w.keyAccessor()(a):void 0});return c.utils.add(a,w.xAxisPadding())}),c.override(w,"_prepareYAxis",function(a){this.__prepareYAxis(a),this.y().rangeBands([this.yAxisHeight(),0],0,1)}),c.override(w,"fadeDeselectedArea",function(){w.hasFilter()?w.selectAll("g."+w.BUBBLE_NODE_CLASS).each(function(a){w.isSelectedNode(a)?w.highlightSelected(this):w.fadeDeselected(this)}):w.selectAll("g."+w.BUBBLE_NODE_CLASS).each(function(){w.resetHighlight(this)})}),w.render();var A=c.rowChart("#rowchart_groups"),B=s.dimension(function(a){return a.group}),C=B.group(),D=n(C);A.margins({top:20,right:0,bottom:20,left:0}).width(parseInt(b.select("#rowchart_groups").style("width"),10)).height(400).gap(2).colors(b.scale.category20c()).colorAccessor(function(a){var b=a.key.split(":"),c=-(1e4*parseInt(b[0])+10*b[1].charCodeAt(2)+b[1].charCodeAt(3));return c}).dimension(B).group(D).ordering(function(a){var b=a.key.split(":"),c=-(1e4*parseInt(b[0])+10*b[1].charCodeAt(2)+b[1].charCodeAt(3));return c}).x(b.scale.linear()).elasticX(!0).xAxis().tickValues([]),A.on("renderlet",l),A.render();var E=c.customSeriesChart("#timeline"),F=s.dimension(function(a){var c=a.group,d=b.time.format("%Y%m%d").parse(a.time),e=a.climax;return[c,d,e]}),G=F.group().reduceSum(function(a){return+a.climax}),H=function(a){var b=c.scatterPlot(a).symbol(function(a){return k(a.key[0])}).symbolSize(6).highlightedSize(10).colors(A.colors()).colorAccessor(function(a){var b=a.key[0].split(":"),c=-(1e4*parseInt(b[0])+10*b[1].charCodeAt(2)+b[1].charCodeAt(3));return c});return b};E.width(parseInt(b.select("#timeline").style("width"),10)).height(200).margins({top:10,right:10,bottom:20,left:20}).brushOn(!0).clipPadding(10).dimension(F).group(G).shareColors(!1).chart(H).seriesAccessor(function(a){return a.key[0]}).x(b.time.scale()).elasticX(!0).keyAccessor(function(a){return a.key[1]}).yAxisLabel("climax score sum").y(b.scale.linear()).elasticY(!0).renderHorizontalGridLines(!0).valueAccessor(function(a){return a.value}).filterHandler(function(a,b){return a.filterFunction(function(a){var c=!0;return b.forEach(function(b){c===!0&&(a[1]<Math.min(b[0][0],b[1][0])||a[1]>Math.max(b[0][0],b[1][0])||a[2]<Math.min(b[0][1],b[1][1])||a[2]>Math.max(b[0][1],b[1][1]))&&(c=!1)}),c}),b}),E.render();var I,J=c.customBubbleChart("#laneChart"),K=s.dimension(function(a){var c=b.time.format("%Y%m%d").parse(a.time),d=a.group;return[d,c]}),L=K.group().reduce(function(a,b){a.climax=a.climax+b.climax;var c=Object.keys(b.actors);return c.forEach(function(c){var d=b.actors[c];d.forEach(function(d){var e=c+" : "+d;a.actors[e]=(a.actors[e]||0)+b.climax})}),a.events[b.event]=(a.events[b.event]||0)+b.climax,b.labels.forEach(function(c){a.labels[c]=(a.labels[c]||0)+b.climax}),a},function(a,b){a.climax=a.climax-b.climax;var c=Object.keys(b.actors);return c.forEach(function(c){var d=b.actors[c];d.forEach(function(d){var e=c+" : "+d;a.actors[e]=(a.actors[e]||0)-b.climax})}),a.events[b.event]=(a.events[b.event]||0)-b.climax,b.labels.forEach(function(c){a.labels[c]=(a.labels[c]||0)-b.climax}),a},function(){return{climax:0,events:{},actors:{},labels:{}}}),M=o(L);J.width(parseInt(b.select("#laneChart").style("width"),10)).height(400).margins({top:10,right:0,bottom:20,left:0}).dimension(K).group(M).transitionDuration(1500).x(b.time.scale()).elasticX(!0).xAxisPadding(100).keyAccessor(function(a){return a.key[1]}).y(I=b.scale.ordinal().domain(function(){var a=M.all().map(function(a){return a.key[0]});return a}()).copy()).valueAccessor(function(a){return a.key[0]}).r(b.scale.linear().domain([0,b.max(J.data(),function(a){return a.value.climax})])).radiusValueAccessor(function(a){return a.value.climax}).minRadius(2).maxBubbleRelativeSize(.015).colors(e.RdYlGn[9]).colorDomain([0,b.max(J.data(),function(a){return a.value.climax})]).colorAccessor(function(a){return a.value.climax}).renderLabel(!0).minRadiusWithLabel(0).label(function(a){var b,c=-1,d=Object.keys(a.value.labels);return d.forEach(function(d){a.value.labels[d]>c&&(b=d,c=a.value.labels[d])}),b.toString()}).renderTitle(!0).title(function(a){var b=a.key[1].getDay()+"/"+a.key[1].getMonth()+"/"+a.key[1].getFullYear(),c=Object.keys(a.value.events),d="";c.forEach(function(b){d+=a.value.events[b]+" : "+b.toString()+"\n"});var e=Object.keys(a.value.actors),f="";e.forEach(function(b){f+=a.value.actors[b]+" : "+b.toString()+"\n"});var g=Object.keys(a.value.labels),h="";g.forEach(function(b){h+=a.value.labels[b]+" : "+b.toString()+"\n"});var i="\n-----Labels-----\n"+h+"\n-----Actors-----\n"+f+"\n-----Time-------\n"+b+"\n-----Group------\n"+a.key[0];return i}),c.override(J,"xAxisMin",function(){var a=b.min(J.data(),function(a){return J.radiusValueAccessor()(a)>0?J.keyAccessor()(a):void 0});return c.utils.subtract(a,J.xAxisPadding())}),c.override(J,"xAxisMax",function(){var a=b.max(J.data(),function(a){return J.radiusValueAccessor()(a)>0?J.keyAccessor()(a):void 0});return c.utils.add(a,J.xAxisPadding())}),c.override(J,"_prepareYAxis",function(a){this.__prepareYAxis(a),this.y().rangeBands([this.yAxisHeight(),0],0,1)}),J.render();var N=c.dataTable("#dataTable"),O=s.dimension(function(a){return[a.group,a.time,a.labels]});N.size(25).width(1200).dimension(O).group(function(){return""}).sortBy(function(a){return a.time}).order(b.ascending).columns([{label:"GroupName",format:function(a){return a.groupName}},{label:"Time",format:function(a){var c=b.time.format("%Y%m%d").parse(a.time);return c.getDay()+"/"+c.getMonth()+"/"+c.getFullYear()}},{label:"Climax Score",format:function(a){return a.climax}},{label:"Mentions",format:function(a){return i(a,r)}},{label:"Labels",format:function(a){return a.labels}}]),N.render()},a.ready.then(this.readData),f.subscribe("data loaded",this.readData)}a.$inject=["DataService","d3","dc","crossfilter","colorbrewer","Messagebus"],angular.module("uncertApp.punchcard").controller("PunchcardController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/punchcard/punchcard.directive.html",controller:"PunchcardController",controllerAs:"punchcardcontroller"}}angular.module("uncertApp.punchcard").directive("punchcardDirective",a)}(),function(){"use strict";function a(a,b,c){var d=this;this.query=b.DATA_JSON_URL,this.clear=function(){d.query=b.DATA_JSON_URL,d.open()},this.open=function(){a.ready.then(function(){c.publish("data request",d.query)})},this.search=function(){d.open()},this.onQueryKeyPress=function(a){var b=13;a.keyCode===b&&d.open()}}a.$inject=["DataService","uncertConf","Messagebus"],angular.module("uncertApp.fileLoading").controller("FileController",a)}(),function(){"use strict";function a(){return{restrict:"EA",templateUrl:"scripts/fileloading/fileLoading.directive.html",controller:"FileController",controllerAs:"fc"}}angular.module("uncertApp.fileLoading").directive("fileLoadingDirective",a)}(),angular.module("uncertApp.templates").run(["$templateCache",function(a){"use strict";a.put("scripts/authentication/authentication.directive.html",'<div ng-show="error" class="alert alert-danger">{{error}}</div>\r\n<div ng-show="!authentication.loggedIn">\r\n  <form name="form" ng-submit="authentication.login()" role="form">\r\n      <div class="form-group">\r\n          <label for="username">Username</label>\r\n          <i class="fa fa-key"></i>\r\n          <input type="text" name="username" id="username" class="form-control" ng-model="username" required />\r\n          <span ng-show="form.username.$dirty && form.username.$error.required" class="help-block">Username is required</span>\r\n      </div>\r\n      <div class="form-group">\r\n          <label for="password">Password</label>\r\n          <i class="fa fa-lock"></i>\r\n          <input type="password" name="password" id="password" class="form-control" ng-model="password" required />\r\n          <span ng-show="form.password.$dirty && form.password.$error.required" class="help-block">Password is required</span>\r\n      </div>\r\n      <div class="form-actions">\r\n          <button type="submit" ng-disabled="form.$invalid || dataLoading" class="btn btn-danger">Login</button>\r\n          <img ng-if="dataLoading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="/>\r\n      </div>\r\n  </form>\r\n<div>\r\n'),a.put("scripts/dcjs/dcjs.directive.html",'<div id="yearly-bubble-chart" class="dcjsContainer">\r\n</div>\r\n'),a.put("scripts/fileloading/fileLoading.directive.html",'<div class="form-group clickable">\n    <div class="input-group">\n        <input type="url" class="form-control" placeholder="Datafile location..." ng-model="fc.query" ng-keypress="fc.onQueryKeyPress($event)">\n        <span class="input-group-btn">\n          <button class="btn btn-default" type="button" ng-click="fc.clear()" title="Clear"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>\n          <button class="btn btn-default" type="button" ng-click="fc.search()" title="Search"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>\n        </span>\n    </div>\n</div>\n'),a.put("scripts/punchcard/punchcard.directive.html",'<div class="content">\n  <div class="mdl-grid">\n    <div class="mdl-cell mdl-cell--12-col myChart">\n      <div class="mdl-grid">\n        <div class="mdl-cell mdl-cell--2-col"><div id="rowchart_allActors"></div></div>\n        <div class="mdl-cell mdl-cell--10-col"><div id="subwayChart"></div></div>\n      </div>\n    </div>\n  </div>\n\n  <div class="mdl-grid">\n    <div class="mdl-cell mdl-cell--12-col myChart">\n      <div class="mdl-grid">\n        <div class="mdl-cell mdl-cell--2-col"><div id="rowchart_groups"></div></div>\n        <div class="mdl-cell mdl-cell--10-col"><div id="laneChart"></div></div>\n      </div>\n      <div class="mdl-grid">\n        <div class="mdl-cell mdl-cell--12-col"><div id="timeline"></div></div>\n      </div>\n    </div>\n  </div>\n\n  <div class="mdl-grid">\n    <div class="mdl-cell mdl-cell--12-col myChart"><div id="dataTable"></div></div>\n  </div>\n</div>\n'),a.put("scripts/rdf/rdf.directive.html",'<div class="container-fluid">\r\n  <div class="row">\r\n    <div class="col-md-12">\r\n      <div>\r\n        <h1>Triples found in trig file</h1>\r\n        <ul>\r\n          <li ng-repeat="triple in rdfcontroller.triples">\r\n            Subject: <a href="{{ triple.subject }}">{{triple.subject}}</a>,\r\n            Predicate: <a href="{{ triple.predicate }}">{{triple.predicate}}</a>,\r\n            Object: <a href="{{ triple.object }}">{{triple.object}}</a>\r\n          </li>\r\n        </ul>\r\n        {{ rdfcontroller.triples.length }} triples found\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'),a.put("scripts/sparql/sparql.directive.html",'<div id="queryResult">\r\n  {{sparqlcontroller.resultText}}\r\n</span>\r\n')}]);